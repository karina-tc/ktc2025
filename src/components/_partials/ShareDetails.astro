---
import { Image } from "astro:assets";
import { details, links, contactInfo } from "../../data/details";
import Subtitle from "../Subtitle.astro";
import avatar from "../../assets/brand/avatar.png";

interface Props {
  reader?: string | null;
}

const { reader } = Astro.props;

// Function to append reader to URLs only if reader exists
const appendReader = (href: string) => {
  if (!reader || reader === "null") return href;
  const separator = href.includes("?") ? "&" : "?";
  const newHref = `${href}${separator}reader=${reader}`;
  return newHref;
};
---

<aside class="details-section">
  <div class="listing">
    <Subtitle title="Karina Tovar Castro" />
    <div class="avatar">
      <Image src={avatar} alt="Karina Tovar" width={600} draggable={false} />
    </div>
    <div class="details">
      <h5 class="subtitle">Details</h5>
      {
        details.map(({ label, value }) => (
          <div class="detail">
            <span>{label}:</span>
            <span>{value}</span>
          </div>
        ))
      }
    </div>
  </div>
  <div class="links">
    <ul>
      {
        links.map(({ icon, href, text }) => (
          <li>
            <Image src={icon} alt={`${text} icon`} />
            <a href={appendReader(href)} target="_blank">
              {text}
            </a>
          </li>
        ))
      }
    </ul>
    <div class="contact">
      <h5 class="subtitle">Contact Email</h5>
      <a href={`mailto:${contactInfo.email}`}>{contactInfo.email}</a>
    </div>
  </div>
</aside>

<script>
  // Get reader from URL on the client side
  const urlParams = new URLSearchParams(window.location.search);
  const reader = urlParams.get("reader");

  // Update all links to include reader parameter
  if (reader) {
    document
      .querySelectorAll('.footer a:not([href^="mailto:"])')
      .forEach((link) => {
        const href = link.getAttribute("href");
        if (href) {
          const separator = href.includes("?") ? "&" : "?";
          link.setAttribute("href", `${href}${separator}reader=${reader}`);
        }
      });
  }
</script>

<style lang="scss">
  @import "../../styles/base/_breakpoints.scss";

  .details-section {
    width: 100%;

    .subtitle {
      font-size: var(--font-size-xsmall);
      font-weight: 600;
      font-family: var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-ink-tertiary);
      margin-bottom: var(--spacing-small);
      opacity: 0.75;
    }

    .listing {
      position: relative;
      font-family: var(--font-sans);
      color: var(--color-ink-secondary);
      padding: var(--spacing-small) var(--spacing-base);
      background-color: rgba(255, 255, 255, 0.75);
      border: 1px solid rgba(255, 255, 255, 0.25);
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(111, 93, 85, 0.2);
      backdrop-filter: blur(5px);
      border-radius: 12px;

      // Avatar
      .avatar {
        width: calc(100% + 50px);
        height: 100px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-left: -25px;
        margin-bottom: var(--spacing-base);
        background-color: var(--color-chocolate);

        img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          mix-blend-mode: lighten;
          transition: all 0.3s cubic-bezier(0.215, 0.61, 0.355, 1);
        }

        @include mobile {
          height: 200px !important;
        }
      }

      // Detail items
      .detail {
        width: 100%;
        height: 28px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        font-weight: 500;
        font-size: var(--font-size-xxs);
        font-family: var(--font-mono);
      }
    }

    // Links section
    .links {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: var(--spacing-base);
      background-color: rgba(255, 255, 255, 0.75);
      border: 1px solid rgba(255, 255, 255, 0.25);
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(111, 93, 85, 0.2);
      backdrop-filter: blur(5px);
      border-radius: 12px;
      padding: var(--spacing-base) 0 var(--spacing-small);
      border-top: 1px dashed var(--color-border);

      // Links list
      ul {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        list-style: none;
        padding: 0 var(--spacing-small);
        margin: -8px 0 var(--spacing-small);

        li {
          width: calc(100% + 16px);
          margin-left: -8px;
          display: flex;
          justify-content: start;
          align-items: center;
          gap: var(--spacing-small);
          padding: var(--spacing-small) 8px;
          border-radius: var(--border-radius-base);
          transition: all 0.2s ease-in-out;

          a {
            flex: 1;
            height: 100%;
            font-weight: 500;
            font-size: var(--font-size-small);
            text-decoration: underline;
            text-underline-offset: 4px;
            text-decoration-color: var(--color-coffee);
            text-decoration-thickness: 2px;
            &:hover {
              text-decoration-color: var(--color-accent);
            }
          }

          img {
            width: 32px;
            height: 32px;
            margin: 0 0 0 4px;
          }

          &:hover {
            background-color: rgba(255, 255, 255, 0.5);
          }
        }
      }

      // Contact section
      .contact {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        margin-top: -20px;
        padding: 0 var(--spacing-base) var(--spacing-base);
        border-top: 1px dashed rgba(255, 255, 255, 0.5);

        a {
          font-weight: 300;
          font-size: var(--font-size-massive);
          font-family: var(--font-headings);
          color: var(--color-ink-tertiary);
        }
      }
    }

    @include desktop-reverse {
      min-width: 420px;
    }

    :global(.subtitle h3 span) {
      font-size: var(--font-size-massive);
    }
  }
</style>
