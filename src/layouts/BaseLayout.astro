---
// Styles
import "../styles/main.scss";

// Components
import CommonHead from "../components/CommonHead.astro";
import Navigation from "../components/Navigation.astro";
import Footer from "../components/Footer.astro";

// Props
interface Props {
	title: string;
	description: string;
	includeNavigation?: boolean;
	includeFooter?: boolean;
}

const {
	title,
	description,
	includeNavigation = true,
	includeFooter = true,
} = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<CommonHead title={title} description={description} />
		
		<!-- Critical styles to prevent flash -->
		<style is:inline>
			body,
			html {
				@media (max-width: 768px) {
					padding: 0 10px;
				}
			}

			main {
				max-width: 100vw;
				min-height: calc(100vh - 340px);
				overflow-x: hidden;
				position: relative;
			}

			/* Critical navigation styles */
			.nav-list {
				display: flex;
				gap: var(--spacing-xsmall);
				list-style: none;
				margin: 0;
				padding: 0;
			}

			.nav-list a {
				text-decoration: none;
				color: var(--color-ink);
				padding: 10px 12px 8px;
				border-radius: 4px;
			}
		</style>
	</head>
	<body>
		{includeNavigation && <Navigation />}
		<main role="main" aria-label="Main Content">
			<slot />
		</main>
		{includeFooter && <Footer />}
	</body>
</html>

<script>
	// Store the current URL before any navigation happens
	document.addEventListener('click', (e) => {
		const target = e.target as HTMLElement;
		const link = target.closest('a');
		
		if (link && !window.location.pathname.includes('404')) {
			console.log('Storing current URL before navigation:', window.location.href);
			sessionStorage.setItem('lastVisitedUrl', window.location.href);
		}
	});

	// Setup Intersection Observer
	import setupIntersectionObserver from "../scripts/intersection-observer";
	setupIntersectionObserver();
</script>
